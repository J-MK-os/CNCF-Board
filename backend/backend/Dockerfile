# 1ë‹¨ê³„: ë¹Œë“œ (Gradle + JDK17)
# ğŸ”§ Gradle 8.10 â†’ 8.14ë¡œ ì˜¬ë¦¼ (Spring Boot 4.0.0 ìš”êµ¬ì‚¬í•­ ë§ì¶”ê¸°)
FROM gradle:8.14.0-jdk17-alpine AS build
WORKDIR /app

# í˜„ì¬ ë””ë ‰í„°ë¦¬(backend/backend)ì˜ ëª¨ë“  í”„ë¡œì íŠ¸ íŒŒì¼ ë³µì‚¬
COPY . .

# Spring Boot jar ë¹Œë“œ
RUN gradle clean bootJar --no-daemon

# 2ë‹¨ê³„: ì‹¤í–‰ (JREë§Œ ìˆëŠ” ê°€ë²¼ìš´ ì´ë¯¸ì§€)
FROM eclipse-temurin:17-jre-alpine
WORKDIR /app

# ë¹Œë“œ ê²°ê³¼ jar ë³µì‚¬ (ì´ë¦„ ìƒê´€ì—†ì´ *.jar í•˜ë‚˜ë§Œ ìˆë‹¤ê³  ê°€ì •)
COPY --from=build /app/build/libs/*.jar app.jar

# K8s/Postgresìš© DB ì„¤ì •
#   application.ymlì˜ ì„¤ì •ë³´ë‹¤ SPRING_DATASOURCE_* í™˜ê²½ë³€ìˆ˜ê°€ ìš°ì„  ì ìš©ë¨
ENV SPRING_DATASOURCE_URL=jdbc:postgresql://postgres:5432/cncf_board
ENV SPRING_DATASOURCE_USERNAME=cncf_user
ENV SPRING_DATASOURCE_PASSWORD=password

# ì„œë²„ í¬íŠ¸
ENV SERVER_PORT=8080
EXPOSE 8080

ENTRYPOINT ["java", "-jar", "app.jar"]
